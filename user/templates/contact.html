{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container py-5">
  <!-- Header Section -->
  <div class="row mb-5 align-items-center">
    <div class="col-md-8">
      <h1 class="fw-bold display-5 text-primary">My Bookings</h1>
      <p class="lead text-muted">Manage and track your service orders</p>
    </div>
    <div class="col-md-4 text-md-end">
      <a href="{% url 'services:services_list' %}" class="btn btn-primary px-4 py-2">
        <i class="fa-solid fa-plus me-2"></i>New Booking
      </a>
    </div>
  </div>

  {% if bookings %}
  <div class="row g-4">
    {% for booking in bookings %}
    <div class="col-lg-6">
      <div class="card border-0 shadow-sm h-100 hover-card rounded-4 overflow-hidden">
        <div class="card-body p-0">
          <div class="row g-0 h-100">
            <!-- Left Status Strip (optional) or just use the badge -->

            <!-- Main Content -->
            <div class="col-12 p-4">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <div class="d-flex align-items-center">
                  {% if booking.service.icon %}
                  <img src="{{ booking.service.icon.url }}" alt="" class="rounded-circle me-3"
                    style="width: 48px; height: 48px; object-fit: cover; background-color: var(--light-bg);">
                  {% else %}
                  <div
                    class="rounded-circle me-3 d-flex align-items-center justify-content-center bg-light text-primary"
                    style="width: 48px; height: 48px;">
                    <i class="fa-solid fa-tools fa-lg"></i>
                  </div>
                  {% endif %}
                  <div>
                    <h5 class="card-title fw-bold mb-1">{{ booking.service.name }}</h5>
                    <div class="small text-muted">Order #{{ booking.id }}</div>
                  </div>
                </div>
                <span class="badge rounded-pill px-3 py-2 
                                    {% if booking.status == 'PENDING' %}text-bg-warning
                                    {% elif booking.status == 'ACCEPTED' %}text-bg-info text-white
                                    {% elif booking.status == 'COMPLETED' %}text-bg-success
                                    {% elif booking.status == 'CANCELLED' %}text-bg-secondary
                                    {% elif booking.status == 'REJECTED' %}text-bg-danger
                                    {% else %}text-bg-primary{% endif %}">
                  {{ booking.get_status_display }}
                </span>
              </div>

              <hr class="my-3 border-light">

              <div class="row g-3">
                <div class="col-md-6">
                  <div class="d-flex align-items-center mb-2">
                    <i class="fa-regular fa-calendar text-primary me-2 width-20"></i>
                    <span class="text-dark fw-medium">{{ booking.booking_date }}</span>
                  </div>
                  <div class="d-flex align-items-center">
                    <i class="fa-regular fa-clock text-primary me-2 width-20"></i>
                    <span class="text-muted">{{ booking.booking_time }}</span>
                  </div>
                </div>
                <div class="col-md-6 border-start-md ps-md-4">
                  <label class="small text-muted text-uppercase fw-bold mb-1">Provider</label>
                  <div class="d-flex align-items-center">
                    {% if booking.provider.profile_picture %}
                    <img src="{{ booking.provider.profile_picture.url }}" class="rounded-circle me-2" alt="Provider"
                      style="width: 32px; height: 32px; object-fit: cover;">
                    {% else %}
                    <div
                      class="rounded-circle me-2 bg-secondary-subtle d-flex align-items-center justify-content-center"
                      style="width: 32px; height: 32px;">
                      <i class="fa-solid fa-user text-secondary small"></i>
                    </div>
                    {% endif %}
                    <span class="fw-medium text-dark">{{ booking.provider.user.username }}</span>
                  </div>
                </div>
              </div>

              <div class="mt-4 p-3 bg-light rounded-3">
                <div class="d-flex align-items-start">
                  <i class="fa-solid fa-location-dot text-danger mt-1 me-2"></i>
                  <div>
                    <div class="small fw-bold text-dark">Service Location</div>
                    <div class="small text-muted">{{ booking.service_address }}, {{ booking.city }}
                    </div>
                  </div>
                </div>
              </div>

              <div class="d-flex justify-content-between align-items-center mt-3 pt-2">
                <div>
                  <span class="small text-muted">Total Amount</span>
                  <div class="h5 fw-bold text-primary mb-0">${{ booking.price }}</div>
                </div>
                {% if booking.status == 'COMPLETED' %}
                <a href="#" class="btn btn-outline-primary btn-sm rounded-pill">
                  <i class="fa-regular fa-star me-1"></i> Rate
                </a>
                {% endif %}
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="text-center py-5">
    <div class="mb-4">
      <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center"
        style="width: 100px; height: 100px;">
        <i class="fa-regular fa-calendar-xmark fa-3x text-muted"></i>
      </div>
    </div>
    <h3 class="fw-bold text-dark">No bookings found</h3>
    <p class="text-muted mb-4">You haven't booked any services yet. Start exploring now!</p>
    <a href="{% url 'services:services_list' %}" class="btn btn-primary btn-lg rounded-pill px-5">
      Browse Services
    </a>
  </div>
  {% endif %}
</div>

<style>
  .width-20 {
    width: 20px;
    text-align: center;
  }

  .border-start-md {
    border-left: 1px solid #dee2e6;
  }

  @media (max-width: 767.98px) {
    .border-start-md {
      border-left: none;
      border-top: 1px solid #dee2e6;
      padding-top: 1rem;
      margin-top: 0.5rem;
    }
  }
</style>
{% endblock %}